---
title: 从url输入到返回请求
date: 2021-02-19 22:22:59
tags:
---
# 从url输入到返回请求

## 从浏览器地址栏输入url到请求返回发生了什么

### 1. DNS解析,将域名解析成IP地址

#### URL

URL(Uniform Resource Locator),统一资源定位符,用于定位互联网上的资源,俗称网址.
`protocol://host.domain:port/path/filename`
- protocol:因特网的协议类型,常见的协议有:http、https、ftp、file,其中最常见的是http,https则是在http的基础上进行加密
- host:定义域主机,http默认主机为www
- domain:因特网域名
- port:主机端口号
- path:服务器上路径
- filename:文档/资源名称

#### IP地址

IP地址是指互联网协议地址.它是IP协议提供的一种统一的地址格式,它为互联网上的每一个网络和每一台主机分配一个逻辑地址,以此来屏蔽物理地址的差异.IP地址是一个32位的二进制数,如127.0.0.1就是本机地址.
域名就相当于是IP地址的代号,它的作用就是便于记忆和沟通一组服务器的地址.

#### DNS

DNS (Domain Name System),因特网作为域名和IP地址相互映射的一个分布式数据库,能够使用户更方便的访问互联网,而不用直接记忆能被机器直接读取的IP数串.

##### DNS域名

- 根域:DNS域名使用时,规定由尾部句点(.)来指定名称,位于根或者更高级别的域层次
- 顶级域:用来展示某个国家/地区/组织使用的名称类型
- 第二层域:个人或组织在Internet上使用的注册名称
- 子域:已注册的二级域名的派生域,俗称网站
- 主机:通常情况下,上文中的host,DNS域名的最左侧标签,标示网络上的特定计算机

##### DNS负载均衡

当一个网站的用户足够多时,假如每次的请求都达到同一台机器上,那么就可能导致机器随时会宕机,这就需要采用DNS负载均衡技术,在DNS服务器中为同一个主机配置多个IP地址,在应答DNS查询时,DNS服务器对每个请求将以主机的DNS文件中IP地址按顺序返回不同的查询结果,将客户端的访问引导到不同的机器上,使得不同的客户端访问到不同的机器,从而达到负载均衡的目的.(机器的负载量、地理位置等)

#### 域名解析

DNS协议提供通过域名查找IP地址,或逆向从IP地址反查域名的服务,而通过域名查找能被机器直接读取的IP数串的过程被称为域名解析.当局部DNS服务器不能回答主机的DNS查询时,它就需要向其他DNS服务器查询,此时可以分为两种方式:递归查询、迭代查询

- 递归查询:当DNS服务器不能回应主机的查询时,DNS服务器会向其他服务器发起查询,一般是向该域名的根域服务器查询,再由根域服务器一级一级向下查询,直到得到查询结果再返回给DNS服务器,再由DNS服务器返回给主机.
- 迭代查询:当DNS服务器不能回应主机的查询时,DNS服务器会把能够解析该域名的其他DNS服务器的IP地址返回给主机,由主机的DNS程序向这些DNS服务器发起查询,直到找到查询结果.

#### 浏览器如何通过域名去查询IP

1. 根据浏览器的缓存查找IP
2. 如果浏览器的缓存中没有查找到的域名,那么就去本地操作系统中的host文件去查找
3. 如果本地的host文件中没有找到,那么就去路由器中查找DNS缓存
4. 如果路由器中没有DNS缓存,那么就去网络供应商的DNS服务器中查找
5. 如果网络供应商的DNS服务器中查找不到,那么就会向跟服务器中查找(递归查询)
6. 如果网路供应商的DNS服务器查找不到,告知你向其他域服务器查找(迭代查询)
7. 找到可以解析IP地址的DNS服务器后,返回给本地DNS服务器地址
8. 本地向DNS服务器发起请求,获取域名对应的IP地址,并将IP地址和域名的映射关系缓存起来,方便下次的访问

### 2. 建立连接,发出请求

拿到域名对应的IP地址后,浏览器会以一个随机端口(1024<端口<65535)向服务器的web程序80端口发起TCP的连接请求,这个请求到达服务端后,进入到网卡,经过内核的TCP/IP协议栈(用于识别连接请求,解封包),还有可能经过防火墙的过滤,到达WEB程序,最终建立TCP/IP连接.

#### TCP三次握手(防止已失效的连接请求报文段突然传送到服务端,因而产生错误)

1. 客户端将标志位SYN置为1,随机产生一个值为seq=X(X的取值范围=1234567)的数据包到达服务器,客户端进入SYN_SENT状态,等待服务端确认.
2. 服务端收到数据包后由标识位SYN=1知道客户端请求建立连接,服务端将SYN和ACK都置为1,ack=X+1,随机产生一个seq=K,并将该数据包发送给客户端确认连接请求,服务端进入SYN_RCVD状态
3. 客户端收到确认,检查ack是否为J+1,ACK是否为1,如果正确则将标识位ACK置为1,ack=K+1,并将该数据包发送给服务端,服务端检查ack是否为K+1,ACK是否为1,如果正确,则建立连接成功,客户端和服务端进入ESTABLISHED状态,完成三次握手,随后客户端和服务端开始传送数据

### OSI七层通信模型

1. 应用层:为应用程序提供服务并规定应用程序中通信的相关细节,包括文件传输、电子邮件、远程登录等协议
2. 表示层:将应用处理的信息转换成适合网络传输的格式,或将下一层的数据转换成上层能够处理的格式,主要负责数据格式的转换
3. 会话层:负责建立和断开通信连接(数据流动的逻辑通路)以及数据的分割等数据传输相关管理
4. 传输层:TCP,可靠传输,只在通信双方节点上进行处理,而无需在路由器上处理
5. 网络层:IP,将数据传输到目标地址.主要负责寻址和路由选择
6. 数据链路层:负责物理层面的互联、节点之间的通信传输
7. 物理层:负责0、1比特流与电压的高低、光的闪灭之间的转换

![OSI七层模型](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ff48f05b7154d47ab834b212d127a0f~tplv-k3u1fbpfcp-zoom-1.image?imageslim)

### HTTP请求

请求报文由请求行、请求头、请求体三部分组成,`POST /chapter/user.html HTTP/1.1`
- 请求行: 包含请求方法、URL、协议版本
   - 请求方法:GET、POST、HEAD、OPTIONS、PUT、DELETE、PATCH、TRACE
   - URL即请求地址
   - 协议版本即http版本号
- 请求头:包含请求的附加信息,由关键字/值对组成,每行一对,关键字和值用:隔开,包括许多有关的客户端环境和请求正文的有用信息:Host:主机名、keepalive:持久连接、User-Agent:请求发出者
- 请求体:承载多个参数的请求数据,包含回车符、换行符、请求数据,并不是所有的请求都有请求数据









