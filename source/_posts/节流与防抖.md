---
title: 节流与防抖
date: 2021-04-01 22:34:40
tags:
---

### 节流

触发事件后,`delay`后执行,如果在这个过程中再次触发不执行(避免事件在短时间内重复触发)

```
function throttle(fn,delay){
  let timer;
  return funtion(){
    const args = [...arguments]
    if(timer) return false
    timer = setTimeout(() => {
      fn.apply(this,args)
    },delay)
  }
}
```

### 防抖

触发事件后,`delay`后执行,如果在这个过程中再次触发事件那么清空之前`delay`,重新计算`delay`后执行(保证事件的完整执行)

```js
function debounce(fn,delay,immedate){
  let timer;
  let result;
  const debounced = function(){
    const context = this
    const args = [...arguments]
    // 如果事件正在触发过程中,中断延时
    if(timer) clearTimeout(timer)
    if(immedate){
      // 如果需要立即执行
      // 判断当前是否处于事件触发
      const callNow = !timer
      // delay后清空timer,避免函数频繁触发
      timer = setTimeout(() => {
        timer = null
      },delay)
      // 立即执行函数
      if(callNow) result = fn(context,args)
    }else{
      // 如果不需要立即执行,delay后执行函数
      timer = setTimeout(()=> {
        result = fn.apply(context,args)
      },delay)
    }
    return result
  }
  debounced.cancel = () =>{
    // 清除定时器,取消函数执行
    clearTimeout(timer)
    timer = null
  }
  return debounced
}
```